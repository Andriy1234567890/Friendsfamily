<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kontrola zvyškov</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 min-h-screen flex">
  <!-- Sidebar -->
  <div id="sidebar" class="bg-white w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition duration-200 ease-in-out z-30 shadow-md">
    <nav>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="alcohol">
        <span>🍹</span><span>Alko</span>
      </a>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="nonalcohol">
        <span>🧃</span><span>Nealko</span>
      </a>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="stock">
        <span>🧑‍🌾</span><span>Sklad</span>
      </a>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="purchase">
        <span>🛒</span><span>Nakup</span>
      </a>
    </nav>
  </div>

  <!-- Main content -->
  <div class="flex-1 p-6">
    <!-- Hamburger button -->
    <button id="menu-btn" class="md:hidden mb-4 bg-gray-200 px-4 py-2 rounded">Menu</button>

    <h1 class="text-2xl font-bold mb-4">Kontrola zvyškov</h1>

    <!-- Tab contents -->
    <div id="nonalcohol" class="tab-content hidden"></div>
    <div id="alcohol" class="tab-content hidden"></div>
    <div id="stock" class="tab-content hidden"></div>
    <div id="purchase" class="tab-content hidden"></div>
  </div>

  <script>
    const client = window.supabase.createClient(
      "https://wmjvkmdignmlnbphqxxd.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndtanZrbWRpZ25tbG5icGhxeHhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1MTU0MzMsImV4cCI6MjA2NDA5MTQzM30.EnEcHJaVyOj6IPmBTR_L2U5BazeaWK3kLnE9aycVZC8"
    );

    const categories = ['nonalcohol', 'alcohol', 'stock', 'purchase'];

    document.getElementById('menu-btn').addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('-translate-x-full');
    });

    document.querySelectorAll('.sidebar-tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        const tab = document.getElementById(btn.dataset.tab);
        tab.classList.remove('hidden');

        if (window.innerWidth < 768) {
          document.getElementById('sidebar').classList.add('-translate-x-full');
          document.querySelector('h1').textContent = btn.textContent.trim();
        }

        renderTable(btn.dataset.tab);
      });
    });

    async function renderTable(tabName) {
      const { data, error } = await client.from(tabName).select('*');
      const container = document.getElementById(tabName);
      container.innerHTML = `
        <form onsubmit="addItem(event, '${tabName}')" class="space-y-2">
          <input type="text" id="${tabName}-name" placeholder="Назва" required class="border p-2 w-full rounded">
          <input type="number" id="${tabName}-quantity" placeholder="Кількість" required class="border p-2 w-full rounded">
          <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Додати</button>
        </form>
        <table class="w-full mt-4 table-auto border border-gray-300">
          <thead>
            <tr class="bg-gray-200">
              <th class="p-2 border">Meno</th>
              <th class="p-2 border">Počet</th>
              <th class="p-2 border">Zmenit</th>
            </tr>
          </thead>
          <tbody id="${tabName}-table"></tbody>
        </table>
      `;
      const tbody = document.getElementById(`${tabName}-table`);
      tbody.innerHTML = '';
      if (data) {
        data.forEach(item => {
          const row = document.createElement('tr');
          row.className = "border-b";
          row.innerHTML = `
            <td class="p-2 border">${item.name}</td>
            <td class="p-2 border"><input type="number" value="${item.quantity}" onchange="updateQuantity('${tabName}', ${item.id}, this.value)" class="border p-1 rounded w-full"></td>
            <td class="p-2 border"><button onclick="deleteItem('${tabName}', ${item.id})" class="text-red-500">Видалити</button></td>
          `;
          tbody.appendChild(row);
        });
      }

      highlightLowStock();
    }

    function highlightLowStock() {
      ['nonalcohol', 'alcohol', 'stock'].forEach(tabName => {
        const tbody = document.getElementById(`${tabName}-table`);
        if (!tbody) return;

        tbody.querySelectorAll('input[type="number"]').forEach(input => {
          const value = parseInt(input.value);
          if (isNaN(value)) return;

          if ((tabName === 'stock' && value <= 2) || (tabName !== 'stock' && value <= 5)) {
            input.classList.add('text-red-600', 'font-bold');
          } else {
            input.classList.remove('text-red-600', 'font-bold');
          }
        });
      });
    }

    window.addItem = async function (event, tabName) {
      event.preventDefault();
      const name = document.getElementById(`${tabName}-name`).value.trim();
      const quantity = parseInt(document.getElementById(`${tabName}-quantity`).value);
      if (name && !isNaN(quantity)) {
        await client.from(tabName).insert([{ name, quantity }]);
        renderTable(tabName);
        event.target.reset();
      }
    }

    window.updateQuantity = async function (tabName, id, quantity) {
      await client.from(tabName).update({ quantity: parseInt(quantity) }).eq('id', id);
      renderTable(tabName);
    }

    window.deleteItem = async function (tabName, id) {
      await client.from(tabName).delete().eq('id', id);
      renderTable(tabName);
    }

    // Автоматично завантажуємо перший таб
    renderTable('nonalcohol');
  </script>
</body>
</html>
