<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–æ–Ω—Ç—Ä–æ–ª—å–≤–∞—ñ–∞—à–∫—ñ–≤ –±–∞—Ä—É</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex">
  <!-- Sidebar -->
  <div id="sidebar" class="bg-white w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition duration-200 ease-in-out z-30 shadow-md">
    <nav>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="alcohol">
        <span>üçπ</span><span>–ê–ª–∫–æ–≥–æ–ª—å–Ω—ñ</span>
      </a>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="nonalcohol">
        <span>üßÉ</span><span>–ë–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—ñ</span>
      </a>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="stock">
        <span>üßë‚Äçüåæ</span><span>–°–∫–ª–∞–¥</span>
      </a>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="purchase">
        <span>üõí</span><span>–ó–∞–∫—É–ø–∫–∞</span>
      </a>
    </nav>
  </div>

  <!-- Main content -->
  <div class="flex-1 p-6">
    <!-- Hamburger button -->
    <button id="menu-btn" class="md:hidden mb-4 bg-gray-200 px-4 py-2 rounded">–ú–µ–Ω—é</button>

    <h1 class="text-2xl font-bold mb-4">–ö–æ–Ω—Ç—Ä–æ–ª—å –∑–∞–ª–∏—à–∫—ñ–≤</h1>

    <!-- Tab contents -->
    <div id="nonalcohol" class="tab-content hidden"></div>
    <div id="alcohol" class="tab-content hidden"></div>
    <div id="stock" class="tab-content hidden"></div>
    <div id="purchase" class="tab-content hidden"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDaE-NfvmNxTRPOkLbbUPKe589HTcK1t4U",
      authDomain: "friendfamily-f8be7.firebaseapp.com",
      projectId: "friendfamily-f8be7",
      storageBucket: "friendfamily-f8be7.firebasestorage.app",
      messagingSenderId: "73705575097",
      appId: "1:73705575097:web:e7343ffa3cc57510d74168",
      measurementId: "G-714EPZNJRJ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const categories = ['nonalcohol', 'alcohol', 'stock', 'purchase'];

    document.getElementById('menu-btn').addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('-translate-x-full');
    });

    document.querySelectorAll('.sidebar-tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        const tab = document.getElementById(btn.dataset.tab);
        tab.classList.remove('hidden');

        if (window.innerWidth < 768) {
          document.getElementById('sidebar').classList.add('-translate-x-full');
          document.querySelector('h1').textContent = btn.textContent.trim();
        }
      });
    });

    categories.forEach(cat => {
      const container = document.getElementById(cat);
      container.innerHTML = `
        <form onsubmit="addProduct(event, '${cat}')" class="space-y-2">
          <input type="text" id="${cat}-name" placeholder="–ù–∞–∑–≤–∞ –ø—Ä–æ–¥—É–∫—Ç—É" required class="border p-2 w-full rounded">
          <input type="number" id="${cat}-quantity" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" required class="border p-2 w-full rounded">
          <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">–î–æ–¥–∞—Ç–∏</button>
        </form>
        <table class="w-full mt-4 table-auto border border-gray-300">
          <thead>
            <tr class="bg-gray-200">
              <th class="p-2 border">–ù–∞–∑–≤–∞</th>
              <th class="p-2 border">–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
              <th class="p-2 border">–î—ñ—ó</th>
            </tr>
          </thead>
          <tbody id="${cat}-table"></tbody>
        </table>
      `;
      renderTable(cat);
    });

    async function getData(cat) {
      const snapshot = await db.collection(cat).get();
      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    }

    async function saveData(cat, data) {
      const ref = db.collection(cat);
      await Promise.all(data.map(item => ref.doc(item.name).set(item)));
    }

    async function renderTable(cat) {
      const data = await getData(cat);
      const table = document.getElementById(`${cat}-table`);
      table.innerHTML = '';
      const lowStock = [];

      data.forEach((product, index) => {
        const row = document.createElement('tr');
        row.className = "border-b";
        row.innerHTML = `
          <td class="p-2 border">${product.name}</td>
          <td class="p-2 border"><input type="number" value="${product.quantity}" onchange="updateQuantity('${cat}', '${product.name}', this.value)" class="border p-1 rounded w-full"></td>
          <td class="p-2 border"><button onclick="removeProduct('${cat}', '${product.name}')" class="text-red-500">–í–∏–¥–∞–ª–∏—Ç–∏</button></td>
        `;
        table.appendChild(row);

        if ((cat === 'alcohol' || cat === 'nonalcohol') && product.quantity < 5) {
          lowStock.push(product);
        } else if (cat === 'stock' && product.quantity < 2) {
          lowStock.push(product);
        }
      });

      if (lowStock.length > 0 && cat !== 'purchase') {
        const purchaseRef = db.collection('purchase');
        const purchaseSnapshot = await purchaseRef.get();
        const purchaseData = purchaseSnapshot.docs.map(doc => doc.data());

        for (const p of lowStock) {
          if (!purchaseData.find(item => item.name === p.name)) {
            await purchaseRef.doc(p.name).set({ name: p.name, quantity: 1 });
          }
        }
        renderTable('purchase');
      }
    }

    window.addProduct = async function (event, cat) {
  event.preventDefault();
  const form = event.target;
  const nameInput = form.querySelector(`#${cat}-name`);
  const quantityInput = form.querySelector(`#${cat}-quantity`);
  
  const name = nameInput.value.trim();
  const quantity = parseInt(quantityInput.value);

  if (name && !isNaN(quantity)) {
    await db.collection(cat).doc(name).set({ name, quantity });
    await renderTable(cat);
    nameInput.value = '';
    quantityInput.value = '';
  }
}


    window.updateQuantity = async function (cat, name, newQuantity) {
      await db.collection(cat).doc(name).update({ quantity: parseInt(newQuantity) });
      renderTable(cat);
    }

    window.removeProduct = async function (cat, name) {
      await db.collection(cat).doc(name).delete();
      renderTable(cat);
    }

    document.querySelector('[data-tab="nonalcohol"]').click();
  </script>
</body>
</html>
