<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kontrola zvy≈°kov</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 min-h-screen flex">
  <!-- Sidebar -->
  <div id="sidebar" class="bg-white w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition duration-200 ease-in-out z-30 shadow-md">
    <nav>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="alcohol">
        <span>üçπ</span><span>Alko</span>
      </a>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="nonalcohol">
        <span>ü¶É</span><span>Nealko</span>
      </a>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="stock">
        <span>üßë‚Äçüåæ</span><span>Sklad</span>
      </a>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="monin">
        <span>üçØ</span><span>Monin</span>
      </a>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="capovane">
        <span>üç∫</span><span>ƒåapovan√©</span>
      </a>
      <a href="#" class="flex items-center space-x-2 px-4 py-2 hover:bg-gray-200 rounded sidebar-tab" data-tab="purchase">
        <span>üõí</span><span>Nakup</span>
      </a>
    </nav>
  </div>

  <!-- Main content -->
  <div class="flex-1 p-6">
    <button id="menu-btn" class="md:hidden mb-4 bg-gray-200 px-4 py-2 rounded">Menu</button>
    <h1 class="text-2xl font-bold mb-4">Kontrola zvy≈°kov</h1>

    <div id="nonalcohol" class="tab-content hidden"></div>
    <div id="alcohol" class="tab-content hidden"></div>
    <div id="stock" class="tab-content hidden"></div>
    <div id="monin" class="tab-content hidden"></div>
    <div id="capovane" class="tab-content hidden"></div>
    <div id="purchase" class="tab-content hidden"></div>
  </div>

<script>
  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Supabase
  const client = window.supabase.createClient(
    "https://wmjvkmdignmlnbphqxxd.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndtanZrbWRpZ25tbG5icGhxeHhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1MTU0MzMsImV4cCI6MjA2NDA5MTQzM30.EnEcHJaVyOj6IPmBTR_L2U5BazeaWK3kLnE9aycVZC8"
  );

  // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–ª—å–æ—Ä—ñ–≤ –¥–ª—è —Å–µ–∫—Ü—ñ–π
  const sectionColors = {
    alcohol: '#1a237e',       // —Ç–µ–º–Ω–æ-—Å–∏–Ω—ñ–π
    nonalcohol: '#6a1b9a',    // —Ñ—ñ–æ–ª–µ—Ç–æ–≤–∏–π
    stock: '#2e7d32',         // –∑–µ–ª–µ–Ω–∏–π
    monin: '#ef6c00',         // –ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π
    capovane: '#c2185b',      // —Ä–æ–∂–µ–≤–æ-—á–µ—Ä–≤–æ–Ω–∏–π
    purchase: '#000000'       // —á–æ—Ä–Ω–∏–π (–∑–∞–ø–∞—Å–Ω–∏–π)
  };

  const categoriesForPurchase = {  // —è–∫—â–æ purchase –º—ñ—Å—Ç–∏—Ç—å category - –ø—Ä–∏–≤'—è–∑—É—î–º–æ –∫–æ–ª—å–æ—Ä–∏
    alcohol: sectionColors.alcohol,
    nonalcohol: sectionColors.nonalcohol,
    stock: sectionColors.stock,
    monin: sectionColors.monin,
    capovane: sectionColors.capovane,
  };

  const categories = ['nonalcohol', 'alcohol', 'stock', 'monin', 'capovane', 'purchase'];

  document.getElementById('menu-btn').addEventListener('click', () => {
    document.getElementById('sidebar').classList.toggle('-translate-x-full');
  });

  document.querySelectorAll('.sidebar-tab').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
      const tab = document.getElementById(btn.dataset.tab);
      tab.classList.remove('hidden');

      if (window.innerWidth < 768) {
        document.getElementById('sidebar').classList.add('-translate-x-full');
        document.querySelector('h1').textContent = btn.textContent.trim();
      }

      renderTable(btn.dataset.tab);
    });
  });

  let currentSort = { key: 'name', asc: true };

  async function renderTable(tabName) {
    const { data, error } = await client.from(tabName).select('*');
    if(error){
      console.error(error);
      return;
    }

    const container = document.getElementById(tabName);
    container.innerHTML = `
      <form id="form-${tabName}" class="space-y-2 mb-4 max-w-md">
        <input type="text" id="${tabName}-name" placeholder="Meno" required class="border p-2 w-full rounded" />
        ${tabName === 'capovane' 
          ? `<input type="text" id="${tabName}-quantity" placeholder="Zvy≈°ok (–±—É–∫–≤–∏ –∞–±–æ —Ü–∏—Ñ—Ä–∏)" required class="border p-2 w-full rounded" />`
          : `<input type="number" step="0.1" min="0" id="${tabName}-quantity" placeholder="Zvy≈°ok (—á–∏—Å–ª–æ)" required class="border p-2 w-full rounded" />`
        }
        ${tabName === 'purchase' ? 
          `<textarea id="${tabName}-comment" placeholder="–ö–æ–º–µ–Ω—Ç–∞—Ä" class="border p-2 w-full rounded mb-2"></textarea>` 
          : ''
        }
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition">Pridat</button>
      </form>
      <div class="flex gap-4 mb-4 max-w-md">
        <button type="button" onclick="sortBy('${tabName}', 'name')" class="bg-gray-300 hover:bg-gray-400 px-3 py-1 rounded transition">Zoradi≈• podƒæa n√°zvu</button>
        <button type="button" onclick="sortBy('${tabName}', 'quantity')" class="bg-gray-300 hover:bg-gray-400 px-3 py-1 rounded transition">Zoradi≈• podƒæa mno≈æstva</button>
      </div>
      <div class="overflow-x-auto max-w-full">
      <table class="w-full table-auto border border-gray-300 rounded-md shadow-sm">
        <thead class="bg-gray-200">
          <tr>
            <th class="p-2 border cursor-pointer select-none" onclick="sortBy('${tabName}', 'name')">Meno</th>
            <th class="p-2 border cursor-pointer select-none" onclick="sortBy('${tabName}', 'quantity')">Zvy≈°ok</th>
            <th class="p-2 border select-none">Zmenit</th>
            ${tabName === 'purchase' ? '<th class="p-2 border select-none">–ö–æ–º–µ–Ω—Ç–∞—Ä</th>' : ''}
            ${tabName === 'purchase' ? '<th class="p-2 border select-none">–î—ñ—è</th>' : ''}
            ${tabName !== 'purchase' ? '<th class="p-2 border select-none">–î–æ–¥–∞—Ç–∏ –≤ Nakup</th>' : ''}
          </tr>
        </thead>
        <tbody id="tbody-' + tabName + '" class="bg-white">
          ${renderRows(data, tabName)}
        </tbody>
      </table>
      </div>
    `;

    // –î–æ–¥–∞—Ç–∏ –æ–±—Ä–æ–±–∫—É —Ñ–æ—Ä–º–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—è
    document.getElementById(`form-${tabName}`).onsubmit = async e => {
      e.preventDefault();
      await addItem(tabName);
    };
  }

  function renderRows(data, tabName) {
    if(!data) return '<tr><td colspan="5" class="p-2 text-center text-gray-500">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</td></tr>';

    // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
    data.sort((a, b) => {
      let valA = a[currentSort.key];
      let valB = b[currentSort.key];
      if (currentSort.key === 'quantity') {
        valA = Number(valA) || 0;
        valB = Number(valB) || 0;
      } else if (typeof valA === 'string' && typeof valB === 'string') {
        valA = valA.toLowerCase();
        valB = valB.toLowerCase();
      }
      if (valA < valB) return currentSort.asc ? -1 : 1;
      if (valA > valB) return currentSort.asc ? 1 : -1;
      return 0;
    });

    return data.map(item => {
      // –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∫–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É —Ä—è–¥–∫–∞
      let textColor = sectionColors[tabName] || '#000';
      // –î–ª—è purchase –±–µ—Ä–µ–º–æ –∫–æ–ª—ñ—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
      if (tabName === 'purchase' && item.category && categoriesForPurchase[item.category]) {
        textColor = categoriesForPurchase[item.category];
      }

      return `
        <tr style="color: ${textColor};" class="border-b hover:bg-gray-50">
          <td class="p-2 border">${item.name || ''}</td>
          <td class="p-2 border">${item.quantity || ''}</td>
          <td class="p-2 border text-center">
            <button onclick="editItem('${tabName}', '${item.id}')" class="text-blue-600 hover:underline">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
          </td>
          ${tabName === 'purchase' ? `<td class="p-2 border">${item.comment || ''}</td>` : ''}
          ${tabName === 'purchase' ? `<td class="p-2 border text-center"><button onclick="deleteItem('${tabName}', '${item.id}')" class="text-red-600 hover:underline">–í–∏–¥–∞–ª–∏—Ç–∏</button></td>` : ''}
          ${tabName !== 'purchase' ? `<td class="p-2 border text-center"><button onclick="addToPurchase('${tabName}', '${item.id}', '${item.name}')" class="text-green-600 hover:underline">+ Nakup</button></td>` : ''}
        </tr>
      `;
    }).join('');
  }

  function sortBy(tabName, key) {
    if(currentSort.key === key) {
      currentSort.asc = !currentSort.asc;
    } else {
      currentSort.key = key;
      currentSort.asc = true;
    }
    renderTable(tabName);
  }

  async function addItem(tabName) {
    let nameInput = document.getElementById(`${tabName}-name`);
    let quantityInput = document.getElementById(`${tabName}-quantity`);
    if (!nameInput.value.trim() || !quantityInput.value.trim()) {
      alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è!');
      return;
    }

    const newItem = {
      name: nameInput.value.trim(),
      quantity: tabName === 'capovane' ? quantityInput.value.trim() : parseFloat(quantityInput.value),
    };

    if (tabName === 'purchase') {
      newItem.comment = document.getElementById('purchase-comment').value.trim();
      // –î–ª—è purchase –º–æ–∂–µ –±—É—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è, –∞–ª–µ –æ—Å–∫—ñ–ª—å–∫–∏ —Ñ–æ—Ä–º–∞ –Ω–µ –º–∞—î –≤–∏–±–æ—Ä—É, —Å—Ç–∞–≤–∏–º–æ 'nonalcohol' –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
      newItem.category = 'nonalcohol';
    }

    const { error } = await client.from(tabName).insert([newItem]);
    if(error){
      alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ: ' + error.message);
      return;
    }
    nameInput.value = '';
    quantityInput.value = '';
    if (tabName === 'purchase') document.getElementById('purchase-comment').value = '';
    renderTable(tabName);
  }

  async function editItem(tabName, id) {
    const { data } = await client.from(tabName).select('*').eq('id', id).single();
    if(!data) return alert('–ó–∞–ø–∏—Å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.');

    // –ü—Ä–æ—Å—Ç–∏–π prompt –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
    const newName = prompt("–ù–æ–≤–∏–π name:", data.name);
    if(newName === null) return;
    let newQuantity = prompt("–ù–æ–≤–µ quantity:", data.quantity);
    if(newQuantity === null) return;

    // –î–ª—è capovane –º–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ —Ä—è–¥–æ–∫, —ñ–Ω–∞–∫—à–µ - —á–∏—Å–ª–æ
    if (tabName !== 'capovane') {
      newQuantity = parseFloat(newQuantity);
      if (isNaN(newQuantity)) {
        alert('–ù–µ–≤—ñ—Ä–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è quantity!');
        return;
      }
    }

    let updates = { name: newName, quantity: newQuantity };

    if (tabName === 'purchase') {
      const newComment = prompt("–ù–æ–≤–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä:", data.comment || '');
      if(newComment === null) return;
      updates.comment = newComment;
    }

    const { error } = await client.from(tabName).update(updates).eq('id', id);
    if(error){
      alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ: ' + error.message);
      return;
    }
    renderTable(tabName);
  }

  async function deleteItem(tabName, id) {
    if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∑–∞–ø–∏—Å?')) return;
    const { error } = await client.from(tabName).delete().eq('id', id);
    if(error){
      alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ: ' + error.message);
      return;
    }
    renderTable(tabName);
  }

  async function addToPurchase(fromTable, id, name) {
    // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó –¥–æ–¥–∞–º–æ –≤ purchase –∑ quantity 1 —ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é fromTable
    const newPurchase = {
      name,
      quantity: 1,
      comment: `–î–æ–¥–∞–Ω–æ –∑ ${fromTable}`,
      category: fromTable
    };
    const { error } = await client.from('purchase').insert([newPurchase]);
    if(error){
      alert('–ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤ Nakup: ' + error.message);
      return;
    }
    alert(`–î–æ–¥–∞–Ω–æ "${name}" –≤ Nakup.`);
    renderTable('purchase');
  }

  // –ü–æ–∫–∞–∑–∞—Ç–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç—ñ –≤–∫–ª–∞–¥–∫—É 'nonalcohol'
  document.querySelector('.sidebar-tab[data-tab="nonalcohol"]').click();
</script>
</body>
</html>
